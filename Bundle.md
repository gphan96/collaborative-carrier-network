# Generating bundle of transport request

## Generating special depot location

From a certain depot location of a carrier, all depot locations of other carrier within a certain radius is considered
as a set of depot locations. A special depot location is generated by getting the mean value of all element in a set of
depot locations. Higher tier of special depot location is generated by forming all special depot location within
a certain radius and getting the mean value of such set of special depot location. Generating function is looped
until the number of special depot location is narrowed down under a certain threshold. Setting the big radius when
generating special depot location helps to narrow down the number of depot locations faster. Whereas the small radius
helps to form bundles more fitting to the carriers.

## Bundles

A bundle is a list of transport request. A bundle has fixed size and contains only transport requests which make profit
to a special depot location. The number of transport requests in a bundle has to be equal or smaller than the size of
bundle. There is a limit to the maximum number of bundles. As long as the amount of bundles doesn't exceed this limit,
new bundle is generated until no more new bundle can be generated. A bundle that contains only transport requests that
are elements in another bundle, in other words, a bundle that is a subset of another bundle, will be deleted.
New bundle will then be generated based on another special depot location.

> <b>Example 1:</b> Bundle A = {R1, R2, R3} and Bundle B = {R2, R4, R5}, both bundle are retained.

> <b>Example 2:</b> Bundle A = {R1, R2} and Bundle B = {R1, R2, R4, R5}, Bundle A is deleted, only Bundle B is retained.

> <b>Note</b>: Use <code>containsAll()</code> method to form all bundle into a nested list of transport request.

### Generating bundles

Requests that make profit to a special depot location are formed into a bundle. Transport requests that don't belong to
any bundles are auctioned off as single request.
   
## Profit calculation

A route is defined as from pickup location to deliver location.

The main profit is based on the differences between the earning per distance on a direct route with the cost per distance that carrier has to pay for travelling on actual route based on the tour generated.

In this situation, the fixed earning cost and loading/unloading cost is not necessary.

* All the request within a bundle has to make positive profit.
* The total revenue of that bundle based on the special depot location also has to be positive. (because the total revenue takes the whole tour length into accounting) ???

# How carrier gonna bid on the bundle

* Not all transport request within a bundle could make profit to the carrier.

* In order to help the carrier to maximize their profit while bidding the bundle, as long as <u>the average profit of all requests within a bundle</u>  is higher than the wishing profit of carrier this bundle will be recommended for such carrier to bid.

* In automatic way, a carrier will always bid on such bundles.

> <b>Example:</b>  
Carrier A set his/her wishing profit for automatic bid is 30.\
Bundle B = {R1, R2, R3, R4}.\
Profit gain on doing R1 is 100, on R2 is 80, on R3 is 50, on R4 is -10.\
The average profit that carrier A gonna have after doing all requests in bundle B is 55.\
Carrier A will automatically bid on bundle B.

> In this example situation, the carrier gonna place their highest possible bid to get such 30 profit from the bundle which is 25.

# How to decide which bundles gonna be sold (not finish)

* Solution 1:

All bundle will be sold at the same time.

The highest bid price (winning price) on a bundle is distributed over all requests within that bundle. This average bid price on a request will be considered (C_a).

If two or more carriers have won repectively two or more bundles which contain some common requests, then only the bundle have the highest C_a will be sold, the rest will be deformed. The uncommon requests in un-sold bundles will be put back to normal bid list. (Or put into second bid list, this list will be started after the current bid list end).

In case bundles A ,B and C have some common requests, and carrier 1 has won on bidding bundles A and B, carrier 2 has won bundle C, then C_a of carrier 1 will be C_a on bundle A + C_a on bundle B while C_a of carrier 2 stay remain. This time bundles A and B will be sold, C will be deformed.

In case bundles A and B have common requests, bundles B and C have common requests, and these bundles are respectively bid by carriers 1, 2 and 3, then bundles A and C will be sold, B will be deformed. 

We can set a profit calculator for the C_a. A smart calculator will decide which bundles gonna be sold to make the highest profit from selling bundle.

* Solution 2:

Set maximum number of bundle that a carrier can win on bidding is 1. 

Then ???


# A Carrier has won multiple bundles which contain common requests.

* In case a carrier has won on bidding 2 or more bundles which have some common transport requests, the paying price on second bundle or other (not the 1st one) will be deducted based on number of common transport request.

> <b>Example:</b> Carrier A has won on bidding bundle B and C which has N requests. These two bundles have 2 common transport requests.\
Carrier A then have to pay for bundle B with price b and bundle C with price (c - c/N*2). Prices b and c are the 2nd highest bid price on each bundle and b > c

> <b>Note:</b> We could transfer all requests in winning bundles of a carrier into a <code>HashMap</code> of winning request with the price winner has to pay. Price of a request is decided by the 2nd highest bid on that bundle over the number of requests within that bundle.

> Check on add new if request is duplicated then the paying price will be replace with the higher one.